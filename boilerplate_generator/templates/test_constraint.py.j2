import os

from pytest_bdd\
    import scenario, given, when, then, parsers

from {{ project.snakename }}.tests.factory\
    import Factory

STORAGE_ENGINE = "INMEMORY"
__fullpath = os.path.dirname(os.path.abspath(__file__))


@scenario(f"{__fullpath.split('/{{ project.name }}/')[0]}"
          "/{{ project.name }}/{{ project.snakename }}"
          "/constraints/{{ project.snakename }}/{{ constraint.snakename }}.constraint",
          "{{ constraint.scenario }}")
def test_{{ constraint.snakename }}():
    pass


@given(parsers.parse("{{ constraint.given | replace('<', '{') | replace('>','}') }}"), target_fixture="context")
def given_{{ constraint.snakename }}({% for param in constraint.given.split('<')[1:] %}{{ param.split('>')[0] }}{% if not loop.last %}, {% endif %}{% endfor %}):
    return {
        {% for param in constraint.given.split('<')[1:] %}
        "{{ param.split('>')[0] }}": {{ param.split('>')[0] }}{% if not loop.last %},{% endif %}

        {% endfor %}
    }


@when(parsers.parse("{{ constraint.when | replace('<', '{') | replace('>','}') }}"))
def when_{{ constraint.snakename }}(context, {% for param in constraint.when.split('<')[1:] %}{{ param.split('>')[0] }}{% if not loop.last %}, {% endif %}{% endfor %}):
    pass


@then(parsers.parse("{{ constraint.then | replace('<', '{') | replace('>','}') }}"))
def then_{{ constraint.snakename }}(context, {% for param in constraint.then.split('<')[1:] %}{{ param.split('>')[0] }}{% if not loop.last %}, {% endif %}{% endfor %}):
    assert True == False
